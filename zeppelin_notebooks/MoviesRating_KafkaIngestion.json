{"paragraphs":[{"text":"sc","user":"anonymous","dateUpdated":"2020-05-15T12:56:45+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res1: org.apache.spark.SparkContext = org.apache.spark.SparkContext@765f778e\n"}]},"apps":[],"jobName":"paragraph_1589502290830_-2065401260","id":"20200131-004923_1753034178","dateCreated":"2020-05-15T00:24:50+0000","dateStarted":"2020-05-15T12:56:45+0000","dateFinished":"2020-05-15T12:57:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2991"},{"text":"%pyspark\n# READING STREAMING DATA FROM KAFKA\ndf = spark \\\n  .readStream \\\n  .format(\"kafka\") \\\n  .option(\"kafka.bootstrap.servers\", \"terraform-instance.southamerica-east1-b.c.sincere-bongo-264115.internal:9094\") \\\n  .option(\"subscribe\", \"movieRatings\") \\\n  .load()","user":"anonymous","dateUpdated":"2020-05-15T13:26:11+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1589502290831_-862896689","id":"20200131-005045_848093629","dateCreated":"2020-05-15T00:24:50+0000","dateStarted":"2020-05-15T13:26:11+0000","dateFinished":"2020-05-15T13:26:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2992"},{"text":"%pyspark\nfrom pyspark.sql.types import *\nfrom pyspark.sql.functions import *\n\n# SETTING SCHEMA AND FORMATTING STREAMING DATA\n\nschema = StructType([ \n                        StructField(\"userId\", IntegerType(), True),\n                        StructField(\"movieId\", IntegerType(), True),\n                        StructField(\"rating\", DoubleType(), True),\n                        StructField(\"timestamp\", IntegerType(), True)\n                    ])\n                        \ndata = df.selectExpr(\"CAST(value AS STRING)\")\\\n        .select(from_json(\"value\", schema).alias(\"data\")).select(\"data.*\")\n","user":"anonymous","dateUpdated":"2020-05-15T13:29:28+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1589502290832_-220909327","id":"20200131-012502_1483452983","dateCreated":"2020-05-15T00:24:50+0000","dateStarted":"2020-05-15T13:29:28+0000","dateFinished":"2020-05-15T13:29:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2993"},{"text":"%pyspark\n# WRITING STREAMING DATA TO DELTA LAKE\nquery = ( data\n    .writeStream\n    .format(\"delta\")\n    .outputMode(\"append\")\n    .option(\"checkpointLocation\", \"gs://teste-caio/movie_ratings/delta/ratings/_checkpoints/etl-from-kafka\")\n    .start(\"gs://teste-caio/movie_ratings/delta/ratings\") )","user":"anonymous","dateUpdated":"2020-05-15T13:29:31+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1589502290832_-1573170268","id":"20200131-014916_694833715","dateCreated":"2020-05-15T00:24:50+0000","dateStarted":"2020-05-15T13:29:31+0000","dateFinished":"2020-05-15T13:29:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2994"},{"text":"%pyspark\n# READ FROM DELTA LAKE\nratings = spark.read.format('delta').load(\"gs://teste-caio/movie_ratings/delta/ratings\")\nratings.count()\n# ratings.printSchema()\n# 27.753.444\n\n# Then: 27.753.541","user":"anonymous","dateUpdated":"2020-05-15T13:31:37+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"27753541\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://playground-cluster-m.southamerica-east1-a.c.sincere-bongo-264115.internal:4040/jobs/job?id=42","http://playground-cluster-m.southamerica-east1-a.c.sincere-bongo-264115.internal:4040/jobs/job?id=44"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1589502290832_1117451918","id":"20200131-021208_1640517312","dateCreated":"2020-05-15T00:24:50+0000","dateStarted":"2020-05-15T13:30:04+0000","dateFinished":"2020-05-15T13:30:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2995"},{"text":"%pyspark\nprint(query.status)\nprint(query.lastProgress)","user":"anonymous","dateUpdated":"2020-05-15T13:32:28+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"{'message': 'Waiting for data to arrive', 'isDataAvailable': False, 'isTriggerActive': False}\n{'id': '87d1abdd-0259-4e34-9c5c-da79a13cb513', 'runId': 'ff106c85-b477-400c-a828-0a81f3af854a', 'name': None, 'timestamp': '2020-05-15T13:32:24.112Z', 'batchId': 11, 'numInputRows': 0, 'inputRowsPerSecond': 0.0, 'processedRowsPerSecond': 0.0, 'durationMs': {'getEndOffset': 0, 'setOffsetRange': 2, 'triggerExecution': 2}, 'stateOperators': [], 'sources': [{'description': 'KafkaV2[Subscribe[movieRatings]]', 'startOffset': {'movieRatings': {'0': 109}}, 'endOffset': {'movieRatings': {'0': 109}}, 'numInputRows': 0, 'inputRowsPerSecond': 0.0, 'processedRowsPerSecond': 0.0}], 'sink': {'description': 'DeltaSink[gs://teste-caio/movie_ratings/delta/ratings]'}}\n"}]},"apps":[],"jobName":"paragraph_1589502290833_678162857","id":"20200202-210433_885195304","dateCreated":"2020-05-15T00:24:50+0000","dateStarted":"2020-05-15T13:32:28+0000","dateFinished":"2020-05-15T13:32:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2996"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2020-05-15T13:20:10+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1589548810774_-339263506","id":"20200515-132010_812769729","dateCreated":"2020-05-15T13:20:10+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2997"}],"name":"MoviesRating_KafkaIngestion","id":"2F8MV12QQ","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}